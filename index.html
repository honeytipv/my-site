<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>개꿀팁 - 의견센터 이메일 인증</title>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      overflow-x: hidden;
    }
    #consentScreen {
      position: fixed;
      z-index: 99999;
      background: white;
      color: black;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      overflow-y: auto;
      padding: 30px 20px;
    }
    #consentScreen p.notice {
      font-weight: bold;
      color: red;
      margin-bottom: 20px;
    }
    .consent-buttons {
      margin-top: 20px;
    }
    .consent-buttons button {
      padding: 10px 18px;
      font-size: 16px;
      margin-right: 10px;
      border-radius: 5px;
      border: none;
      background-color: purple;
      color: white;
      cursor: pointer;
    }
    #copyright {
      position: absolute;
      top: 10px;
      left: 15px;
      font-size: 12px;
      color: #666;
    }
    #lawModal {
      display: none;
      position: fixed;
      z-index: 100000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
    }
    #lawModal .modal-law-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 600px;
      margin: 100px auto;
      position: relative;
      white-space: pre-wrap;
    }
    #lawModal .close-button {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
    }
    #mainApp {
      display: none;
      padding: 20px;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    #searchInput {
      flex-grow: 1;
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
      margin-right: 15px;
    }
    .help-box {
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .help-icon {
      width: 35px;
      height: 35px;
    }
    .container {
      min-height: 300px;
    }
    .product-box {
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      overflow: hidden;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
    }
    .product-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .product-number {
      font-weight: bold;
      font-size: 18px;
      color: purple;
      width: 30px;
    }
    .product-box img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 5px;
    }
    .title {
      font-size: 16px;
      flex-grow: 1;
    }
    a.product-link {
      text-decoration: none;
      color: inherit;
      display: flex;
      width: 100%;
      align-items: center;
    }

    /* 모달 공통 */
    .modal-overlay {
      display: none;
      position: fixed;
      z-index: 100000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
    }
    .modal-content {
      background: white;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
      margin: 100px auto;
      padding: 20px;
      position: relative;
      box-sizing: border-box;
    }
    .close-button {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      user-select: none;
    }
    input, textarea, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
      box-sizing: border-box;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-family: inherit;
    }
    textarea {
      resize: vertical;
      min-height: 80px;
    }
    button {
      background-color: purple;
      color: white;
      border: none;
      cursor: pointer;
    }

  </style>
</head>
<body>
  <!-- 동의서 화면 -->
  <div id="consentScreen">
    <div id="copyright">© 2025 개꿀팁. 무단 복제 및 재배포 금지.</div>
    <p class="notice">※ 개꿀팁 기능을 이용하려면 아래 자세히 보기를 반드시 확인해 주세요.</p>
    <div class="consent-buttons">
      <button id="consentAgree">동의</button>
      <button id="showLawModal">자세히 보기</button>
    </div>
  </div>

  <!-- 법적 고지 모달 -->
  <div id="lawModal">
    <div class="modal-law-content">
      <span class="close-button" id="closeLawModal">×</span>
      <strong>[의견 제출 기능 이용에 대한 고지 및 법적 동의서]</strong>

      본 웹페이지의 의견 제출 기능은 외부 메일 처리 서비스(Formspree.io)의 송신 인터페이스를 기반으로 운영되며, 사용자가 입력한 이메일 주소 및 의견 내용은 운영자에게 직접 전달됩니다.

      이에 따라 사용자는 의견 제출 이전에 다음 사항을 충분히 숙지하고, 이에 전적으로 동의한 것으로 간주됩니다.

      1. 본 페이지 내 스크립트에 포함된 Formspree 메일 송신 경로 또는 링크를 임의로 열람·조작하거나, 타인의 메일 주소를 무단으로 도용하여 메시지를 전송하는 행위는 부정 접속 및 기능 변조로 간주될 수 있습니다.

      2. 수신자 이메일 주소를 대상으로 욕설, 도배, 광고, 비방, 모욕, 성적 표현, 협박 등 사회적으로 부적절하거나 법률 위반 소지가 있는 내용을 반복적으로 전송할 경우, 「형법」 및 「정보통신망법」 등에 따라 민·형사상 법적 책임이 발생할 수 있습니다.

      3. 본 시스템은 서버 로그를 수집하거나 IP 정보를 기록하지 않지만, 전송된 메시지 및 메일 수신 시점 등의 기록은 보존될 수 있으며, 운영자 판단에 따라 법적 조치를 요청할 수 있습니다.

      사용자는 위 사항을 충분히 이해하였으며, 이에 전적으로 동의합니다.
    </div>
  </div>

  <!-- 메인 앱 -->
  <div id="mainApp">
    <div class="top-bar">
      <input type="text" id="searchInput" placeholder="숫자를 검색하세요 (예: 1)" />
      <div class="help-box" id="openModal">
        <img
          src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSoYnzdTBQO1svckSLMMg75P7ZQ51xkkMyccbffdrJ2&s"
          alt="고객센터"
          class="help-icon"
        />
        <div class="label">의견센터</div>
      </div>
    </div>

    <div class="container" id="results"></div>
  </div>

  <!-- 의견 모달 -->
  <div id="feedbackModal" class="modal-overlay">
    <div class="modal-content">
      <span id="closeModal" class="close-button">×</span>
      <form id="feedbackForm">
        <input
          type="email"
          id="userEmail"
          name="user_email"
          placeholder="이메일 주소를 입력하세요"
          required
        />
        <textarea
          id="userMessage"
          name="message"
          placeholder="의견 사항을 입력해주세요..."
          required
        ></textarea>
        <button type="submit">보내기</button>
      </form>
    </div>
  </div>

  <!-- 인증번호 입력 모달 -->
  <div id="otpModal" class="modal-overlay">
    <div class="modal-content">
      <span id="closeOtpModal" class="close-button">×</span>
      <p>이메일로 전송된 6자리 인증번호를 입력하세요.</p>
      <input type="text" id="otpInput" placeholder="인증번호 입력" maxlength="6" />
      <button id="verifyOtpBtn">인증하고 전송</button>
    </div>
  </div>

  <script>
    // EmailJS 초기화 (Public Key)
    emailjs.init("cEMhcSRW87GAAMaL7");

    // 동의서 동의 버튼
    document.getElementById("consentAgree").addEventListener("click", () => {
      document.getElementById("consentScreen").style.display = "none";
      document.getElementById("mainApp").style.display = "block";
    });

    // 자세히 보기 모달 열기/닫기
    document.getElementById("showLawModal").addEventListener("click", () => {
      document.getElementById("lawModal").style.display = "block";
    });
    document.getElementById("closeLawModal").addEventListener("click", () => {
      document.getElementById("lawModal").style.display = "none";
    });

    // 의견센터 모달 열기/닫기
    document.getElementById("openModal").addEventListener("click", () => {
      document.getElementById("feedbackModal").style.display = "block";
    });
    document.getElementById("closeModal").addEventListener("click", () => {
      document.getElementById("feedbackModal").style.display = "none";
    });

    // 인증번호 모달 닫기
    document.getElementById("closeOtpModal").addEventListener("click", () => {
      document.getElementById("otpModal").style.display = "none";
    });

    // 바깥 클릭 시 모달 닫기
    window.addEventListener("click", (e) => {
      const feedbackModal = document.getElementById("feedbackModal");
      const lawModal = document.getElementById("lawModal");
      const otpModal = document.getElementById("otpModal");

      if (e.target === feedbackModal) feedbackModal.style.display = "none";
      if (e.target === lawModal) lawModal.style.display = "none";
      if (e.target === otpModal) otpModal.style.display = "none";
    });

    // OTP 저장용 변수와 임시 폼 데이터 저장 변수
    let currentOtp = "";
    let tempFormData = {};

    // 의견 제출 폼 제출 시 (이메일, 의견 작성 후 보내기 클릭)
    document.getElementById("feedbackForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const email = document.getElementById("userEmail").value.trim();
      const message = document.getElementById("userMessage").value.trim();

      if (!email || !message) {
        alert("이메일과 의견을 모두 입력해 주세요.");
        return;
      }

      // 6자리 랜덤 OTP 생성
      currentOtp = Math.floor(100000 + Math.random() * 900000).toString();

      // EmailJS를 이용해 OTP 이메일 전송
      emailjs.send("service_x70u0xh", "template_62q5w2q", {
        user_email: email,
        otp_code: currentOtp
      }).then(() => {
        alert("인증번호가 이메일로 전송되었습니다.");
        tempFormData = { user_email: email, message: message };
        // 의견 모달 닫고 OTP 모달 열기
        document.getElementById("feedbackModal").style.display = "none";
        document.getElementById("otpModal").style.display = "block";
      }).catch((error) => {
        alert("인증번호 전송 실패: " + JSON.stringify(error));
      });
    });

    // 인증번호 확인 후 최종 의견 전송
    document.getElementById("verifyOtpBtn").addEventListener("click", () => {
      const enteredOtp = document.getElementById("otpInput").value.trim();

      if (enteredOtp === currentOtp) {
        // OTP 일치 시 의견 최종 전송
        emailjs.send("service_x70u0xh", "template_62q5w2q", tempFormData)
          .then(() => {
            alert("의견이 성공적으로 전송되었습니다!");
            document.getElementById("otpModal").style.display = "none";
            document.getElementById("otpInput").value = "";
            document.getElementById("feedbackForm").reset();
          }).catch((error) => {
            alert("의견 전송 실패: " + JSON.stringify(error));
          });
      } else {
        alert("인증번호가 일치하지 않습니다.");
      }
    });

    // 제품 데이터 (예시)
    const products = [
      {
        number: "1",
        image:
          "https://thumbnail9.coupangcdn.com/thumbnails/remote/492x492ex/image/vendor_inventory/91d7/4ba4cc9def1ff057f50b1d95b68dbc418a1e9e785a6c2597961ebf28daa2.jpg",
        title: "트랄랄레로 트랄랄라 인형",
        link: "https://link.coupang.com/a/czNwDC",
      }
    ];

    // 제품 렌더링
    function renderProducts(filter = "") {
      const results = document.getElementById("results");
      results.innerHTML = "";
      const filtered = products.filter(p => !filter || p.number === filter);
      filtered.forEach(product => {
        const box = document.createElement("div");
        box.className = "product-box";
        box.innerHTML = `
          <a href="${product.link}" target="_blank" class="product-link">
            <div class="product-info">
              <div class="product-number">${product.number}</div>
              <img src="${product.image}" alt="product ${product.number}" />
            </div>
            <div class="title">${product.title}</div>
          </a>`;
        results.appendChild(box);
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      const input = document.getElementById("searchInput");
      input.addEventListener("input", () => {
        renderProducts(input.value.trim());
      });
      renderProducts();
    });
  </script>
</body>
</html>
